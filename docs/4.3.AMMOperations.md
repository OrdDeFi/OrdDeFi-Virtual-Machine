# Add Liquidity Provider

A typical `addlp` instruction:

```
{
  "p":"orddefi",
  "op":"addlp",
  "ltick":"odfi",
  "rtick":"odgv",
  "lamt":"1000",
  "ramt":"1000"
}
```

Param List:

* The `ltick` and `rtick` parameters represent the names of the coins for which liquidity providers are being added.
* The `lamt` parameter represents the amount of `ltick` being used to add liquidity.
* The `ramt` parameter represents the amount of `rtick` being used to add liquidity.

The coins will be added to the liquidity provider pool from the current address's available sub-account, in a 50:50 ratio based on the liquidity provider's current price. Any excess coins will be kept in the available sub-account.

Once the transaction for the `addlp` operation is confirmed, use the following commands for further queries:  

* To retrieve liquidity provider information for a specific coin pair, use: `./OrdDeFi-Virtual-Machine -getlpmeta [coinA-coinB]`.
* To check the balance of liquidity provider tokens owned by a specific address, use: `./OrdDeFi-Virtual-Machine -getaddresslpbalance [address]`.


# Swap

A typical `swap` instruction:

```
{
  "p":"orddefi",
  "op":"swap",
  "ltick":"odfi",
  "rtick":"odgv",
  "spend":"odfi",
  "amt":"1000"
}
```

A `swap` instruction with `threshold` parameter:

```
{
  "p":"orddefi",
  "op":"swap",
  "ltick":"odfi",
  "rtick":"odgv",
  "spend":"odfi",
  "amt":"1000",
  "threshold":"0.005"
}
```

Param List:

* The `ltick` and `rtick` parameters represent the names of the coins for which liquidity providers are trading on.
* The `spend` parameter represents the coin to spend, must equal to `ltick` or `rtick`.
* The `amt` parameter represents the amount of `spend` being used to swap.
* The `threshold` parameter represents the max allowable slippage at swap.

The `swap` instruction utilizes the widely adopted `x*y=k` algorithm within the Automated Market Maker (AMM).
When performing a `swap`, the price is subject to slippage. You can explicitly specify the `threshold` parameter to limit the maximum allowable slippage during the `swap`. If the price deviation exceeds the specified `threshold` in relation to the original price, the swap instruction will be abandoned, and the swap action will not be executed. By providing a `threshold` value of `0.005`, slippage of less than `0.5%` is allowed. If you do not provide this parameter, the `threshold` defaults to 1, which means allowing for the maximum slippage.

Once the transaction for the `swap` operation is confirmed, you can use the following commands for further queries:  

* To retrieve liquidity provider information for a specific coin pair, use: `./OrdDeFi-Virtual-Machine -getlpmeta [coinA-coinB]`.
* To check the balance of coins owned by a specific address, use: `./OrdDeFi-Virtual-Machine -getaddressbalance [address]`.

The OrdDeFi kernel does not provide router functionality. Therefore, if you need to route between multiple liquidity providers (LPs), you should calculate the optimal swap path before making the call and include multiple swap instructions within the transaction. To understand how to include multiple swap instructions in a transaction, please refer to [Batch Operations for AMM](https://github.com/OrdDefi/OrdDefi-Virtual-Machine/blob/main/docs/4.1.OperationCompiler.md#batch-operations-for-amm)


# Remove Liquidity Provider

A typical `rmlp` instruction:

```
{
  "p":"orddefi",
  "op":"rmlp",
  "ltick":"odfi",
  "rtick":"odgv",
  "amt":"1000"
}
```

Param List:

* The `ltick` and `rtick` parameters represent the names of the coins for which liquidity providers are being removed.
* The `amt` parameter represents the amount of liquidity provider tokens being removed.

Before initiating the `rmlp` transaction, you can query the liquidity provider token amount of your address using the command: `./OrdDeFi-Virtual-Machine -getaddresslpbalance [address]`.

Once the transaction for the `rmlp` operation is confirmed, use the following commands to perform further queries:

* To retrieve liquidity provider information for a specific coin pair, use: `./OrdDeFi-Virtual-Machine -getlpmeta [coinA-coinB]`.
* To check the balance of coins owned by a specific address, use: `./OrdDeFi-Virtual-Machine -getaddressbalance [address]`.